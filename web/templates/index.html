{% extends "base.html" %}

{% block content %}
<section class="hero hero-live">
  <div class="card stream-card">
    <div class="media-frame stream-frame">
      <div class="stream-pill">Live</div>
      <img
        id="stream-view"
        data-stream-url="{{ stream_url or '' }}"
        data-stream-port="{{ stream_port or '' }}"
        data-stream-path="{{ stream_path }}"
        alt="Live stream"
      />
    </div>
  </div>
  <div class="card stats-card">
    <div class="section-header compact">
      <h2>Pipeline</h2>
    </div>
    <div class="status-grid compact">
      <article class="status-card">
        <div class="stat-value">{{ recognized_count }}</div>
        <div class="stat-label">Recognized</div>
        <a href="/clips" class="stat-footer">Clips</a>
      </article>
      <article class="status-card">
        <div class="stat-value">{{ unknown_count }}</div>
        <div class="stat-label">Unknown</div>
        <a href="/clips?category=unknown" class="stat-footer">Review</a>
      </article>
      <article class="status-card">
        <div class="stat-value">{{ unlabeled_count }}</div>
        <div class="stat-label">Unlabeled</div>
        <a href="/unlabeled" class="stat-footer">Images</a>
      </article>
      <article class="status-card">
        <div class="stat-value">{{ training_count }}</div>
        <div class="stat-label">Training</div>
        <a href="/training" class="stat-footer">Dataset</a>
      </article>
    </div>
  </div>
</section>

<script>
  const streamEl = document.getElementById("stream-view");
  if (streamEl) {
    let src = streamEl.dataset.streamUrl;
    if (!src) {
      const port = streamEl.dataset.streamPort || "8081";
      const path = streamEl.dataset.streamPath || "/?action=stream";
      const host = window.location.hostname;
      const protocol = window.location.protocol.startsWith("http") ? window.location.protocol : "http:";
      src = `${protocol}//${host}${port ? `:${port}` : ""}${path}`;
    }
    streamEl.src = src;
  }
</script>
{% endblock %}
